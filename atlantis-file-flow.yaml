# Atlantis Configuration for FileFlow Project
# https://www.runatlantis.io/docs/repo-level-atlantis-yaml.html

version: 3

# Global settings
automerge: false
delete_source_branch_on_merge: false
# Disable parallel plan to prevent plugin cache conflicts
parallel_plan: false
parallel_apply: false

# Projects configuration
projects:
  # ============================================================================
  # FileFlow Infrastructure Components
  # ============================================================================
  # Generated by infra-wizard
  # Environment: prod
  # Shared Resources: RDS MySQL (from Infrastructure repo)
  # ============================================================================

  # NOTE: ECR is managed in infrastructure repo (terraform/ecr/fileflow)
  # FileFlow repo only manages application-specific infrastructure

  # 1. ElastiCache Redis - Dedicated cache layer
  - name: fileflow-redis-prod
    dir: terraform/elasticache-redis
    workspace: default
    autoplan:
      when_modified: ["*.tf", "*.tfvars"]
      enabled: true

  # 2. S3 Bucket - File storage
  - name: fileflow-s3-prod
    dir: terraform/s3-bucket
    workspace: default
    autoplan:
      when_modified: ["*.tf", "*.tfvars"]
      enabled: true

  # 3. ECS Service - Application service
  - name: fileflow-ecs-prod
    dir: terraform/ecs-service
    workspace: default
    autoplan:
      when_modified: ["*.tf", "*.tfvars"]
      enabled: true
