# Infrastructure ëª¨ë“ˆ ì‚¬ìš© ê°€ì´ë“œ

ë‹¤ë¥¸ í”„ë¡œì íŠ¸ì—ì„œ ì´ Infrastructure ë ˆí¬ì˜ ëª¨ë“ˆì„ ì‚¬ìš©í•˜ëŠ” ë°©ë²•ì„ ì„¤ëª…í•©ë‹ˆë‹¤.

## ğŸ“‹ ëª©ì°¨

1. [ECR ìƒì„±í•˜ê¸°](#1-ecr-ìƒì„±í•˜ê¸°)
2. [VPC ê³µìœ  ë¦¬ì†ŒìŠ¤ ì°¸ì¡°í•˜ê¸°](#2-vpc-ê³µìœ -ë¦¬ì†ŒìŠ¤-ì°¸ì¡°í•˜ê¸°)
3. [ì™„ì „í•œ ECS ì„œë¹„ìŠ¤ êµ¬ì¶•](#3-ì™„ì „í•œ-ecs-ì„œë¹„ìŠ¤-êµ¬ì¶•)

---

## 1. ECR ìƒì„±í•˜ê¸°

### ì‹œë‚˜ë¦¬ì˜¤
FileFlow í”„ë¡œì íŠ¸ì—ì„œ Docker ì´ë¯¸ì§€ë¥¼ ì €ì¥í•  ECR ë ˆí¬ì§€í† ë¦¬ë¥¼ ìƒì„±í•˜ë ¤ê³  í•©ë‹ˆë‹¤.

### Step 1: í”„ë¡œì íŠ¸ êµ¬ì¡° í™•ì¸

```bash
cd ~/fileflow

# í”„ë¡œì íŠ¸ êµ¬ì¡°
fileflow/
â”œâ”€â”€ src/                 # ì• í”Œë¦¬ì¼€ì´ì…˜ ì½”ë“œ
â”œâ”€â”€ Dockerfile
â””â”€â”€ terraform/           # ì´ ë””ë ‰í† ë¦¬ë¥¼ ìƒì„±í•  ì˜ˆì •
```

### Step 2: ì‚¬ìš© ê°€ëŠ¥í•œ ëª¨ë“ˆ í™•ì¸

```bash
# Claude Codeì—ì„œ
/if/module list

# ë˜ëŠ” ì§ì ‘ ì‹¤í–‰
/path/to/infrastructure/scripts/modules/module-manager.sh list
```

**ì¶œë ¥ ì˜ˆì‹œ**:
```
â„¹ï¸  ì‚¬ìš© ê°€ëŠ¥í•œ Infrastructure ëª¨ë“ˆ ëª©ë¡:

ğŸ“¦ ecr
   Latest: v1.0.0
   ğŸ“ Amazon ECR repository with KMS encryption

ğŸ“¦ alb
   Latest: v1.0.0
   ğŸ“ Application Load Balancer with HTTPS support

ğŸ“¦ ecs-service
   Latest: v1.0.0
   ğŸ“ ECS Service with Auto Scaling
```

### Step 3: ECR ëª¨ë“ˆ ìƒì„¸ ì •ë³´ í™•ì¸

```bash
# Claude Codeì—ì„œ
/if/module info ecr

# ë˜ëŠ” ì§ì ‘ ì‹¤í–‰
/path/to/infrastructure/scripts/modules/module-manager.sh info ecr
```

**ì¶œë ¥ ì˜ˆì‹œ**:
```
ğŸ“¦ Module: ecr (v1.0.0)

ğŸ“ Description:
Amazon ECR repository with KMS encryption and lifecycle policies

ğŸ“‹ Available versions:
  - v1.0.0 (latest)

ğŸ“‚ Module structure:
terraform/modules/ecr/
â”œâ”€â”€ README.md
â”œâ”€â”€ main.tf
â”œâ”€â”€ variables.tf
â”œâ”€â”€ outputs.tf
â””â”€â”€ examples/

ğŸ”§ Usage example:
module "ecr" {
  source = "git::https://github.com/ryuqqq/infrastructure.git//terraform/modules/ecr?ref=modules/ecr/v1.0.0"

  repository_name      = "fileflow"
  image_tag_mutability = "MUTABLE"
  scan_on_push         = true

  common_tags = {
    Environment = "prod"
    Service     = "fileflow"
  }
}
```

### Step 4: ECR ëª¨ë“ˆ ì´ˆê¸°í™”

```bash
# FileFlow í”„ë¡œì íŠ¸ì—ì„œ
cd ~/fileflow

# ECR ëª¨ë“ˆ ì„¤ì • íŒŒì¼ ìë™ ìƒì„±
/if/module init ecr@v1.0.0

# ë˜ëŠ” ì§ì ‘ ì‹¤í–‰
/path/to/infrastructure/scripts/modules/module-manager.sh init ecr@v1.0.0
```

**ìƒì„±ë˜ëŠ” íŒŒì¼**:
```
terraform/
â”œâ”€â”€ provider.tf                    # AWS Provider ì„¤ì • (ì‹ ê·œ ìƒì„±)
â”œâ”€â”€ variables.tf                   # ê³µí†µ ë³€ìˆ˜ (ì‹ ê·œ ìƒì„±)
â””â”€â”€ ecr/                          # ECR ëª¨ë“ˆ ë””ë ‰í† ë¦¬
    â”œâ”€â”€ main.tf                   # ëª¨ë“ˆ ì°¸ì¡° ì½”ë“œ
    â”œâ”€â”€ outputs.tf                # ì¶œë ¥ ë³€ìˆ˜
    â”œâ”€â”€ example.tf.template       # ì‚¬ìš© ì˜ˆì œ (ì°¸ê³ ìš©)
    â””â”€â”€ variables-reference.tf.md # ë³€ìˆ˜ ë¬¸ì„œ
```

### Step 5: ìƒì„±ëœ íŒŒì¼ í™•ì¸ ë° ìˆ˜ì •

**`terraform/ecr/main.tf`** (ìë™ ìƒì„±ë¨):
```hcl
# ecr Module Configuration
# Version: v1.0.0
# Auto-generated by /if/module init

module "ecr" {
  source = "git::https://github.com/ryuqqq/infrastructure.git//terraform/modules/ecr?ref=modules/ecr/v1.0.0"

  # TODO: Configure module variables
  # See variables-reference.tf.md for available options
}
```

### Step 6: ëª¨ë“ˆ ë³€ìˆ˜ ì„¤ì •

**`terraform/ecr/main.tf`** ìˆ˜ì •:
```hcl
# ecr Module Configuration
# Version: v1.0.0
# Auto-generated by /if/module init

module "ecr" {
  source = "git::https://github.com/ryuqqq/infrastructure.git//terraform/modules/ecr?ref=modules/ecr/v1.0.0"

  # ê¸°ë³¸ ì„¤ì •
  repository_name      = "fileflow"
  image_tag_mutability = "MUTABLE"
  scan_on_push         = true

  # Lifecycle ì •ì±… (ì„ íƒ)
  lifecycle_policy = {
    rules = [
      {
        rulePriority = 1
        description  = "Keep last 30 tagged images"
        selection = {
          tagStatus     = "tagged"
          tagPrefixList = ["v"]
          countType     = "imageCountMoreThan"
          countNumber   = 30
        }
        action = {
          type = "expire"
        }
      },
      {
        rulePriority = 2
        description  = "Keep last 10 untagged images"
        selection = {
          tagStatus   = "untagged"
          countType   = "imageCountMoreThan"
          countNumber = 10
        }
        action = {
          type = "expire"
        }
      }
    ]
  }

  # ê³µí†µ íƒœê·¸
  common_tags = {
    Environment = var.environment
    Service     = "fileflow"
    ManagedBy   = "terraform"
    Owner       = "fbtkdals2@naver.com"
    CostCenter  = "engineering"
  }
}
```

### Step 7: Provider ì„¤ì • í™•ì¸

**`terraform/provider.tf`** (ìë™ ìƒì„±ë¨):
```hcl
terraform {
  required_version = ">= 1.5.0"

  required_providers {
    aws = {
      source  = "hashicorp/aws"
      version = "~> 5.0"
    }
  }

  backend "s3" {
    bucket         = "your-org-prod-tfstate"
    key            = "fileflow/ecr/terraform.tfstate"
    region         = "ap-northeast-2"
    encrypt        = true
    dynamodb_table = "terraform-lock"
    kms_key_id     = "alias/terraform-state"
  }
}

provider "aws" {
  region = var.aws_region

  default_tags {
    tags = {
      Project   = "fileflow"
      ManagedBy = "terraform"
    }
  }
}
```

### Step 8: ë³€ìˆ˜ ì„¤ì •

**`terraform/variables.tf`** (ìë™ ìƒì„±ë¨):
```hcl
variable "aws_region" {
  description = "AWS region"
  type        = string
  default     = "ap-northeast-2"
}

variable "environment" {
  description = "Environment name"
  type        = string
  default     = "prod"
}
```

### Step 9: Terraform ì´ˆê¸°í™” ë° ì ìš©

```bash
cd ~/fileflow/terraform/ecr

# Terraform ì´ˆê¸°í™”
terraform init

# ì‹¤í–‰ ê³„íš í™•ì¸
terraform plan

# ë¦¬ì†ŒìŠ¤ ìƒì„±
terraform apply
```

**ì¶œë ¥ ì˜ˆì‹œ**:
```
Terraform will perform the following actions:

  # module.ecr.aws_ecr_repository.this will be created
  + resource "aws_ecr_repository" "this" {
      + arn                  = (known after apply)
      + name                 = "fileflow"
      + registry_id          = (known after apply)
      + repository_url       = (known after apply)

      + encryption_configuration {
          + encryption_type = "KMS"
          + kms_key        = (known after apply)
        }

      + image_scanning_configuration {
          + scan_on_push = true
        }
    }

Plan: 2 to add, 0 to change, 0 to destroy.

Do you want to perform these actions?
  Enter a value: yes

Apply complete! Resources: 2 added, 0 changed, 0 destroyed.

Outputs:

repository_url = "123456789012.dkr.ecr.ap-northeast-2.amazonaws.com/fileflow"
```

### Step 10: ì¶œë ¥ê°’ í™•ì¸

**`terraform/ecr/outputs.tf`** (ìë™ ìƒì„±ë¨):
```hcl
output "repository_url" {
  description = "ECR repository URL"
  value       = module.ecr.repository_url
}

output "repository_arn" {
  description = "ECR repository ARN"
  value       = module.ecr.repository_arn
}

output "registry_id" {
  description = "Registry ID"
  value       = module.ecr.registry_id
}
```

```bash
# ì¶œë ¥ê°’ í™•ì¸
terraform output

# íŠ¹ì • ì¶œë ¥ê°’ë§Œ í™•ì¸
terraform output repository_url
```

---

## 2. VPC ê³µìœ  ë¦¬ì†ŒìŠ¤ ì°¸ì¡°í•˜ê¸°

### ì‹œë‚˜ë¦¬ì˜¤
FileFlow í”„ë¡œì íŠ¸ì—ì„œ Infrastructure ë ˆí¬ì— ì´ë¯¸ ë°°í¬ëœ ê³µìœ  VPCë¥¼ ì°¸ì¡°í•˜ë ¤ê³  í•©ë‹ˆë‹¤.

### Step 1: ì‚¬ìš© ê°€ëŠ¥í•œ ê³µìœ  ë¦¬ì†ŒìŠ¤ í™•ì¸

```bash
# Claude Codeì—ì„œ
/if/shared list

# ë˜ëŠ” ì§ì ‘ ì‹¤í–‰
/path/to/infrastructure/scripts/shared/shared-infra-manager.sh list
```

**ì¶œë ¥ ì˜ˆì‹œ**:
```
â„¹ï¸  ì‚¬ìš© ê°€ëŠ¥í•œ ê³µìœ  ì¸í”„ë¼ ë¦¬ì†ŒìŠ¤:

ğŸŒ vpc
   ğŸ“ VPC Network
   ğŸ“‚ terraform/network

ğŸ“¡ subnets
   ğŸ“ Public/Private/Data Subnets
   ğŸ“‚ terraform/network

ğŸ“Š rds
   ğŸ“ RDS MySQL Database
   ğŸ“‚ terraform/rds
```

### Step 2: VPC ìƒì„¸ ì •ë³´ í™•ì¸

```bash
# VPC ì •ë³´ í™•ì¸
/if/shared info vpc

# Subnets ì •ë³´ í™•ì¸
/if/shared info subnets
```

**ì¶œë ¥ ì˜ˆì‹œ**:
```
â„¹ï¸  ê³µìœ  ë¦¬ì†ŒìŠ¤: VPC Network

ğŸ“‹ SSM Parameters:
  âœ“ /shared/vpc/vpc-id
    Current value: vpc-0abc123def456

  âœ“ /shared/vpc/cidr-block
    Current value: 10.0.0.0/16

ğŸ’¡ Terraformì—ì„œ ì‚¬ìš©í•˜ëŠ” ë°©ë²•:
data "aws_ssm_parameter" "vpc_id" {
  name = "/shared/vpc/vpc-id"
}

resource "aws_security_group" "app" {
  vpc_id = data.aws_ssm_parameter.vpc_id.value
  # ...
}
```

### Step 3: VPC ì°¸ì¡° ì½”ë“œ ìƒì„±

```bash
# VPC ì°¸ì¡° ì½”ë“œ ìë™ ìƒì„±
/if/shared get vpc

# Subnets ì°¸ì¡° ì½”ë“œ ìë™ ìƒì„±
/if/shared get subnets
```

**ìƒì„±ë˜ëŠ” íŒŒì¼**:
- `/tmp/shared-vpc.tf` - VPC ì°¸ì¡° ì½”ë“œ
- `/tmp/shared-subnets.tf` - Subnets ì°¸ì¡° ì½”ë“œ

### Step 4: ìƒì„±ëœ íŒŒì¼ì„ í”„ë¡œì íŠ¸ë¡œ ë³µì‚¬

```bash
cd ~/fileflow/terraform

# ê³µìœ  ë¦¬ì†ŒìŠ¤ ì°¸ì¡° íŒŒì¼ ë³µì‚¬
cp /tmp/shared-vpc.tf ./shared-vpc.tf
cp /tmp/shared-subnets.tf ./shared-subnets.tf
```

**`terraform/shared-vpc.tf`** ë‚´ìš©:
```hcl
# Shared Infrastructure Reference: VPC Network
# Auto-generated by /if/shared get vpc
# Description: Shared VPC for all services

# VPC Information
data "aws_ssm_parameter" "vpc_id" {
  name = "/shared/vpc/vpc-id"
}

data "aws_ssm_parameter" "vpc_cidr" {
  name = "/shared/vpc/cidr-block"
}

# Local variables for easy access
locals {
  vpc_id   = data.aws_ssm_parameter.vpc_id.value
  vpc_cidr = data.aws_ssm_parameter.vpc_cidr.value
}
```

**`terraform/shared-subnets.tf`** ë‚´ìš©:
```hcl
# Shared Infrastructure Reference: Subnets
# Auto-generated by /if/shared get subnets
# Description: Public/Private/Data Subnets

# Subnet Information
data "aws_ssm_parameter" "public_subnet_ids" {
  name = "/shared/vpc/public-subnet-ids"
}

data "aws_ssm_parameter" "private_subnet_ids" {
  name = "/shared/vpc/private-subnet-ids"
}

data "aws_ssm_parameter" "data_subnet_ids" {
  name = "/shared/vpc/data-subnet-ids"
}

# Local variables for easy access
locals {
  public_subnets  = split(",", data.aws_ssm_parameter.public_subnet_ids.value)
  private_subnets = split(",", data.aws_ssm_parameter.private_subnet_ids.value)
  data_subnets    = split(",", data.aws_ssm_parameter.data_subnet_ids.value)
}
```

### Step 5: ALB ìƒì„± ì‹œ ê³µìœ  VPC ì‚¬ìš©

```bash
# ALB ëª¨ë“ˆ ì´ˆê¸°í™”
/if/module init alb@v1.0.0
```

**`terraform/alb/main.tf`** ìˆ˜ì •:
```hcl
module "alb" {
  source = "git::https://github.com/ryuqqq/infrastructure.git//terraform/modules/alb?ref=modules/alb/v1.0.0"

  name    = "fileflow-alb"
  vpc_id  = local.vpc_id                    # ê³µìœ  VPC ID ì‚¬ìš©
  subnets = local.public_subnets            # ê³µìœ  Public Subnets ì‚¬ìš©

  # Security Group
  security_group_ids = [aws_security_group.alb.id]

  # HTTPS ë¦¬ìŠ¤ë„ˆ
  enable_https    = true
  certificate_arn = data.aws_ssm_parameter.certificate_arn.value

  common_tags = {
    Environment = "prod"
    Service     = "fileflow"
    ManagedBy   = "terraform"
  }
}

# ALB Security Group
resource "aws_security_group" "alb" {
  name        = "fileflow-alb-sg"
  description = "Security group for FileFlow ALB"
  vpc_id      = local.vpc_id                # ê³µìœ  VPC ID ì‚¬ìš©

  ingress {
    from_port   = 443
    to_port     = 443
    protocol    = "tcp"
    cidr_blocks = ["0.0.0.0/0"]
  }

  egress {
    from_port   = 0
    to_port     = 0
    protocol    = "-1"
    cidr_blocks = [local.vpc_cidr]          # ê³µìœ  VPC CIDR ì‚¬ìš©
  }

  tags = {
    Name        = "fileflow-alb-sg"
    Environment = "prod"
    Service     = "fileflow"
  }
}
```

---

## 3. ì™„ì „í•œ ECS ì„œë¹„ìŠ¤ êµ¬ì¶•

### ì‹œë‚˜ë¦¬ì˜¤
FileFlowì˜ ì™„ì „í•œ ì¸í”„ë¼ë¥¼ êµ¬ì¶•í•©ë‹ˆë‹¤: ECR + ALB + ECS Service + RDS

### Step 1: í•„ìš”í•œ ëª¨ë“ˆ ë° ê³µìœ  ë¦¬ì†ŒìŠ¤ í™•ì¸

```bash
# ëª¨ë“ˆ ëª©ë¡ í™•ì¸
/if/module list

# ê³µìœ  ë¦¬ì†ŒìŠ¤ ëª©ë¡ í™•ì¸
/if/shared list
```

### Step 2: ëª¨ë“  ëª¨ë“ˆ ì´ˆê¸°í™”

```bash
cd ~/fileflow

# ECR ëª¨ë“ˆ
/if/module init ecr@v1.0.0

# ALB ëª¨ë“ˆ
/if/module init alb@v1.0.0

# ECS Service ëª¨ë“ˆ
/if/module init ecs-service@v1.0.0
```

### Step 3: ê³µìœ  ë¦¬ì†ŒìŠ¤ ì°¸ì¡° ì½”ë“œ ìƒì„±

```bash
# VPC ë° Subnets
/if/shared get vpc
/if/shared get subnets

# RDS
/if/shared get rds

# KMS Keys
/if/shared get kms

# Route53 & ACM
/if/shared get route53
/if/shared get acm

# ìƒì„±ëœ íŒŒì¼ë“¤ì„ í”„ë¡œì íŠ¸ë¡œ ë³µì‚¬
cp /tmp/shared-*.tf ~/fileflow/terraform/
```

### Step 4: í”„ë¡œì íŠ¸ êµ¬ì¡° í™•ì¸

```
fileflow/
â”œâ”€â”€ src/
â”œâ”€â”€ Dockerfile
â””â”€â”€ terraform/
    â”œâ”€â”€ provider.tf
    â”œâ”€â”€ variables.tf
    â”œâ”€â”€ shared-vpc.tf
    â”œâ”€â”€ shared-subnets.tf
    â”œâ”€â”€ shared-rds.tf
    â”œâ”€â”€ shared-kms.tf
    â”œâ”€â”€ shared-route53.tf
    â”œâ”€â”€ shared-acm.tf
    â”œâ”€â”€ ecr/
    â”‚   â”œâ”€â”€ main.tf
    â”‚   â””â”€â”€ outputs.tf
    â”œâ”€â”€ alb/
    â”‚   â”œâ”€â”€ main.tf
    â”‚   â””â”€â”€ outputs.tf
    â””â”€â”€ ecs-service/
        â”œâ”€â”€ main.tf
        â””â”€â”€ outputs.tf
```

### Step 5: ECS Service ì„¤ì •

**`terraform/ecs-service/main.tf`**:
```hcl
module "ecs_service" {
  source = "git::https://github.com/ryuqqq/infrastructure.git//terraform/modules/ecs-service?ref=modules/ecs-service/v1.0.0"

  # ê¸°ë³¸ ì„¤ì •
  cluster_name = "prod-cluster"
  service_name = "fileflow"

  # Task ì •ì˜
  task_definition = {
    family             = "fileflow"
    cpu                = 256
    memory             = 512
    execution_role_arn = aws_iam_role.ecs_execution.arn
    task_role_arn      = aws_iam_role.ecs_task.arn

    container_definitions = jsonencode([
      {
        name      = "fileflow"
        image     = "${data.terraform_remote_state.ecr.outputs.repository_url}:latest"
        essential = true

        portMappings = [
          {
            containerPort = 8080
            protocol      = "tcp"
          }
        ]

        environment = [
          {
            name  = "DB_HOST"
            value = local.rds_endpoint
          },
          {
            name  = "DB_USER"
            value = local.rds_username
          },
          {
            name  = "DB_NAME"
            value = local.rds_dbname
          }
        ]

        secrets = [
          {
            name      = "DB_PASSWORD"
            valueFrom = data.aws_secretsmanager_secret.rds.arn
          }
        ]

        logConfiguration = {
          logDriver = "awslogs"
          options = {
            "awslogs-group"         = "/ecs/fileflow"
            "awslogs-region"        = var.aws_region
            "awslogs-stream-prefix" = "fileflow"
          }
        }
      }
    ])
  }

  # ë„¤íŠ¸ì›Œí¬ ì„¤ì • (ê³µìœ  VPC ì‚¬ìš©)
  subnets         = local.private_subnets
  security_groups = [aws_security_group.ecs_tasks.id]

  # ALB ì—°ê²°
  load_balancer = {
    target_group_arn = data.terraform_remote_state.alb.outputs.target_group_arn
    container_name   = "fileflow"
    container_port   = 8080
  }

  # Auto Scaling
  enable_autoscaling = true
  min_capacity       = 2
  max_capacity       = 10

  autoscaling_policies = {
    cpu = {
      target_value       = 70
      scale_in_cooldown  = 300
      scale_out_cooldown = 60
    }
    memory = {
      target_value       = 80
      scale_in_cooldown  = 300
      scale_out_cooldown = 60
    }
  }

  common_tags = {
    Environment = "prod"
    Service     = "fileflow"
    ManagedBy   = "terraform"
  }
}

# ECS Tasks Security Group
resource "aws_security_group" "ecs_tasks" {
  name        = "fileflow-ecs-tasks-sg"
  description = "Security group for FileFlow ECS tasks"
  vpc_id      = local.vpc_id

  ingress {
    from_port       = 8080
    to_port         = 8080
    protocol        = "tcp"
    security_groups = [data.terraform_remote_state.alb.outputs.security_group_id]
  }

  egress {
    from_port   = 0
    to_port     = 0
    protocol    = "-1"
    cidr_blocks = ["0.0.0.0/0"]
  }

  tags = {
    Name        = "fileflow-ecs-tasks-sg"
    Environment = "prod"
    Service     = "fileflow"
  }
}
```

### Step 6: Remote State ì°¸ì¡° (ì„ íƒ)

ë‹¤ë¥¸ Terraform stateì˜ ì¶œë ¥ê°’ì„ ì°¸ì¡°í•˜ë ¤ë©´:

**`terraform/ecs-service/data.tf`**:
```hcl
# ECR ì¶œë ¥ê°’ ì°¸ì¡°
data "terraform_remote_state" "ecr" {
  backend = "s3"

  config = {
    bucket = "your-org-prod-tfstate"
    key    = "fileflow/ecr/terraform.tfstate"
    region = "ap-northeast-2"
  }
}

# ALB ì¶œë ¥ê°’ ì°¸ì¡°
data "terraform_remote_state" "alb" {
  backend = "s3"

  config = {
    bucket = "your-org-prod-tfstate"
    key    = "fileflow/alb/terraform.tfstate"
    region = "ap-northeast-2"
  }
}
```

### Step 7: ì „ì²´ ë°°í¬

```bash
# 1. ECR ìƒì„±
cd ~/fileflow/terraform/ecr
terraform init && terraform apply

# 2. Docker ì´ë¯¸ì§€ ë¹Œë“œ ë° í‘¸ì‹œ
cd ~/fileflow
docker build -t fileflow:latest .
aws ecr get-login-password --region ap-northeast-2 | docker login --username AWS --password-stdin $(terraform -chdir=terraform/ecr output -raw repository_url | cut -d'/' -f1)
docker tag fileflow:latest $(terraform -chdir=terraform/ecr output -raw repository_url):latest
docker push $(terraform -chdir=terraform/ecr output -raw repository_url):latest

# 3. ALB ìƒì„±
cd ~/fileflow/terraform/alb
terraform init && terraform apply

# 4. ECS Service ìƒì„±
cd ~/fileflow/terraform/ecs-service
terraform init && terraform apply
```

---

## ğŸ“ ìš”ì•½

### ëª¨ë“ˆ ì‚¬ìš© (ìƒˆ ë¦¬ì†ŒìŠ¤ ìƒì„±)

1. `/if/module list` - ì‚¬ìš© ê°€ëŠ¥í•œ ëª¨ë“ˆ í™•ì¸
2. `/if/module info <module>` - ëª¨ë“ˆ ìƒì„¸ ì •ë³´
3. `/if/module init <module>@<version>` - í”„ë¡œì íŠ¸ì— ëª¨ë“ˆ ì„¤ì •
4. ìƒì„±ëœ `main.tf` ìˆ˜ì •
5. `terraform init && terraform apply`

### ê³µìœ  ë¦¬ì†ŒìŠ¤ ì°¸ì¡° (ê¸°ì¡´ ë¦¬ì†ŒìŠ¤ ì‚¬ìš©)

1. `/if/shared list` - ì‚¬ìš© ê°€ëŠ¥í•œ ê³µìœ  ë¦¬ì†ŒìŠ¤ í™•ì¸
2. `/if/shared info <resource>` - ë¦¬ì†ŒìŠ¤ ìƒì„¸ ì •ë³´
3. `/if/shared get <resource>` - ì°¸ì¡° ì½”ë“œ ìƒì„±
4. ìƒì„±ëœ `shared-*.tf` íŒŒì¼ì„ í”„ë¡œì íŠ¸ë¡œ ë³µì‚¬
5. `local.*` ë³€ìˆ˜ë¡œ ì°¸ì¡°

### ë² ìŠ¤íŠ¸ í”„ë™í‹°ìŠ¤

- âœ… **ë²„ì „ ëª…ì‹œ**: í•­ìƒ íŠ¹ì • ë²„ì „ ì‚¬ìš© (`@v1.0.0`)
- âœ… **ê³µìœ  ë¦¬ì†ŒìŠ¤ ìš°ì„ **: ê°€ëŠ¥í•˜ë©´ ê³µìœ  VPC/RDS/KMS ì‚¬ìš©
- âœ… **Remote State**: ëª¨ë“ˆ ê°„ ì˜ì¡´ì„±ì€ Remote Stateë¡œ ê´€ë¦¬
- âœ… **íƒœê·¸ ì¼ê´€ì„±**: `common_tags` ì‚¬ìš©
- âœ… **ë¬¸ì„œí™”**: ê° ëª¨ë“ˆì˜ ìš©ë„ì™€ ì„¤ì •ì„ ì£¼ì„ìœ¼ë¡œ ëª…ì‹œ

---

**Related Documents**:
- [Module Management Command](/docs/claude-commands/if/module.md)
- [Shared Infrastructure Command](/docs/claude-commands/if/shared.md)
- [Hybrid Infrastructure Guide](/docs/guides/hybrid-infrastructure-guide.md)
