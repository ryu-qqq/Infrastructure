# Atlantis Server-Side Repository Configuration
# This file defines organization-level policies and permissions

repos:
  # Infrastructure repository - Terraform automation infrastructure
  - id: github.com/ryu-qqq/Infrastructure
    allowed_overrides: [workflow, apply_requirements]
    allowed_workflows: [default, custom]
    allow_custom_workflows: true

  # Crawler repository
  - id: github.com/ryu-qqq/crawler
    allowed_overrides: [workflow, apply_requirements]
    allowed_workflows: [default, custom]
    allow_custom_workflows: true

  # AuthHub repository - Authentication service
  - id: github.com/ryu-qqq/authhub
    allowed_overrides: [workflow, apply_requirements]
    allowed_workflows: [default, custom]
    allow_custom_workflows: true

  # FileFlow repository - File management service
  - id: github.com/ryu-qqq/fileflow
    allowed_overrides: [workflow, apply_requirements]
    allowed_workflows: [default, custom]
    allow_custom_workflows: true

# Default workflow for all repositories
workflows:
  default:
    plan:
      steps:
        - init
        - plan
    apply:
      steps:
        - apply

  # Custom workflow with additional validation
  custom:
    plan:
      steps:
        - init
        - run: terraform fmt -check
        - run: terraform validate
        - plan
    apply:
      steps:
        - apply

# Global apply requirements (can be overridden by repos)
apply_requirements: [mergeable]

# Parallel plan/apply settings
parallel_plan: true
parallel_apply: false
