# {{ service_name | upper }} - ECS Service Infrastructure

**Generated by Infrastructure Wizard**

This directory contains the infrastructure code for the `{{ service_name }}` service.

## üìã Service Configuration

| Property | Value |
|----------|-------|
| **Service Name** | {{ service_name }} |
| **Environment** | {{ environment }} |
| **CPU** | {{ cpu }} units |
| **Memory** | {{ memory }} MiB |
| **Container Port** | {{ container_port }} |
| **Desired Count** | {{ desired_count }} |

## üèóÔ∏è Infrastructure Components

### Core Components
- ‚úÖ **ECS Service** (Fargate)
- ‚úÖ **CloudWatch Log Group** (retention: {{ environment == 'prod' and '30' or '7' }} days)
- ‚úÖ **Security Groups** (ECS tasks)

{% if include_alb %}
### Load Balancer
- ‚úÖ **Application Load Balancer**
- ‚úÖ **Target Group** (health check: `{{ health_check_path }}`)
- ‚úÖ **Security Group** (ALB)
{% endif %}

{% if database == "shared-rds" %}
### Database
- ‚úÖ **Shared RDS** (referenced via SSM Parameter Store)
{% elif database == "dedicated-rds" %}
### Database
- ‚úÖ **Dedicated RDS** (PostgreSQL/MySQL)
{% endif %}

{% if cache == "shared-elasticache" %}
### Cache
- ‚úÖ **Shared ElastiCache** (referenced via SSM Parameter Store)
{% elif cache == "dedicated-redis" or cache == "dedicated-memcached" %}
### Cache
- ‚úÖ **Dedicated ElastiCache** ({{ cache | replace('dedicated-', '') | upper }})
{% endif %}

## üîó Shared Infrastructure References

This service references the following shared infrastructure:

| Resource | SSM Parameter | Source |
|----------|---------------|--------|
| **VPC ID** | `/shared/network/vpc-id` | terraform/network/ |
| **Private Subnets** | `/shared/network/private-subnet-ids` | terraform/network/ |
{% if include_alb %}
| **Public Subnets** | `/shared/network/public-subnet-ids` | terraform/network/ |
{% endif %}
| **KMS (ECS Secrets)** | `alias/ecs-secrets` | terraform/kms/ |
| **KMS (Logs)** | `alias/cloudwatch-logs` | terraform/kms/ |
{% if database == "shared-rds" %}
| **RDS Endpoint** | `/shared/rds/db-instance-address` | terraform/rds/ |
| **RDS Port** | `/shared/rds/db-instance-port` | terraform/rds/ |
{% endif %}

## üöÄ Deployment

### Prerequisites
- AWS credentials configured
- Terraform >= 1.5.0
- Shared infrastructure deployed (network, kms, etc.)

### Deploy via Atlantis (Recommended)
```bash
# 1. Create PR with changes
git checkout -b feat/update-{{ service_name }}
# ... make changes ...
git push

# 2. Atlantis automatically runs plan
# 3. Review plan results in PR comment
# 4. Approve and merge ‚Üí Atlantis applies automatically
```

### Manual Deployment (Development Only)
```bash
cd terraform/services/{{ service_name }}

# Initialize
terraform init

# Plan
terraform plan

# Apply (requires approval)
terraform apply
```

## üìä Outputs

After deployment, the following outputs are available:

```bash
terraform output
```

Key outputs:
- `ecs_service_id`: ECS service identifier
- `security_group_id`: Security group for ECS tasks
- `cloudwatch_log_group_name`: Log group name
{% if include_alb %}
- `alb_dns_name`: ALB DNS endpoint
- `target_group_arn`: Target group ARN
{% endif %}

## üîß Configuration

### Environment Variables
```bash
ENVIRONMENT={{ environment }}
SERVICE_NAME={{ service_name }}
{% if database == "shared-rds" %}
DB_HOST=${DB_HOST}  # from SSM
DB_PORT=${DB_PORT}  # from SSM
{% endif %}
```

### Secrets (AWS Secrets Manager)
{% if database == "shared-rds" %}
- `DB_PASSWORD`: Database password (referenced via SSM)
{% endif %}

## üìù Maintenance

### Scaling
Update `desired_count` in `main.tf` and create a PR.

### Resource Updates
Modify the relevant `.tf` files and create a PR. Atlantis will show the plan.

### Logs
```bash
# View logs in CloudWatch
aws logs tail /aws/ecs/{{ service_name }} --follow

# Or use AWS Console
https://console.aws.amazon.com/cloudwatch/home?region=ap-northeast-2#logsV2:log-groups/log-group/$252Faws$252Fecs$252F{{ service_name }}
```

## üè∑Ô∏è Tags

All resources are tagged with:
```hcl
Environment = "{{ environment }}"
Service     = "{{ service_name }}"
Owner       = "platform-team@example.com"
CostCenter  = "engineering"
ManagedBy   = "terraform"
```

## üìö Related Documentation

- [ECS Module](../../modules/ecs-service/README.md)
{% if include_alb %}
- [ALB Module](../../modules/alb/README.md)
{% endif %}
- [Infrastructure Governance](../../docs/governance/)
- [Atlantis Operations](../../docs/guides/atlantis-operations.md)

---

**Last Updated**: {{ generation_date }}
**Generated by**: Infrastructure Wizard v1.0.0
