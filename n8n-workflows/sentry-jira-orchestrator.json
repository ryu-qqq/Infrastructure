{
  "name": "Sentry Jira Orchestrator",
  "nodes": [
    {
      "parameters": {
        "httpMethod": "POST",
        "path": "sentry-alert",
        "options": {}
      },
      "type": "n8n-nodes-base.webhook",
      "typeVersion": 2,
      "position": [200, 300],
      "id": "webhook-sentry",
      "name": "Sentry Webhook",
      "webhookId": "sentry-alert-webhook"
    },
    {
      "parameters": {
        "jsCode": "// Sentry ì›¹í›… payload íŒŒì‹±\nconst rawInput = $input.first().json;\n\n// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•\n// ğŸ”§ í”„ë¡œì íŠ¸ ë§¤í•‘ ì„¤ì • (ì—¬ê¸°ì„œ í•œ ë²ˆì— ê´€ë¦¬!)\n// Sentry í”„ë¡œì íŠ¸ slug â†’ Jira í”„ë¡œì íŠ¸ í‚¤, GitHub ë ˆí¬, ë²„ê·¸ ì´ìŠˆíƒ€ì… ID\n// âš ï¸ AUT, MAR í”„ë¡œì íŠ¸ëŠ” Jiraì—ì„œ ë²„ê·¸ ì´ìŠˆíƒ€ì… ì¶”ê°€ í•„ìš”!\n// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•\nconst PROJECT_CONFIG = {\n  'authhub': { jira: 'AUT', github: 'ryu-qqq/AuthHub', bugTypeId: '10260' },\n  'fileflow': { jira: 'KAN', github: 'ryu-qqq/FileFlow', bugTypeId: '10260' },\n  'setof-commerce': { jira: 'SC', github: 'ryu-qqq/setof-commerce', bugTypeId: '10262' },\n  'crawlinghub': { jira: 'CRAW', github: 'ryu-qqq/CrawlingHub', bugTypeId: '10261' },\n  'marketplace': { jira: 'MAR', github: 'ryu-qqq/MarketPlace', bugTypeId: '10260' },\n  'connectly-gateway': { jira: 'GAT', github: 'ryu-qqq/Gateway', bugTypeId: '10259' }\n};\nconst DEFAULT_CONFIG = { jira: 'KAN', github: 'ryu-qqq/AuthHub', bugTypeId: '10260' };\n// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•\n\n// ë””ë²„ê¹…: ì‹¤ì œ ë“¤ì–´ì˜¨ ë°ì´í„° êµ¬ì¡° í™•ì¸\nconst debugInfo = {\n  rawInputKeys: Object.keys(rawInput),\n  hasBody: !!rawInput.body,\n  hasAction: !!rawInput.action,\n  hasData: !!rawInput.data,\n  actionValue: rawInput.action || rawInput.body?.action || 'none',\n  dataKeys: rawInput.data ? Object.keys(rawInput.data) : (rawInput.body?.data ? Object.keys(rawInput.body.data) : [])\n};\n\n// n8nì´ headers/bodyë¡œ ë˜í•‘í•œ ê²½ìš° body ì¶”ì¶œ, ì•„ë‹ˆë©´ ê·¸ëŒ€ë¡œ ì‚¬ìš©\nconst input = rawInput.body || rawInput;\n\nlet errorData = {\n  project: 'unknown',\n  project_slug: 'unknown',\n  title: 'Unknown Error',\n  message: '',\n  level: 'error',\n  environment: 'production',\n  url: '',\n  web_url: '',\n  culprit: '',\n  filename: '',\n  lineno: '',\n  function: '',\n  stacktrace: '',\n  timestamp: new Date().toISOString(),\n  event_count: 1,\n  issue_id: ''\n};\n\n// URLì—ì„œ í”„ë¡œì íŠ¸ slug ì¶”ì¶œí•˜ëŠ” í•¨ìˆ˜\nfunction extractProjectSlug(url) {\n  if (!url) return 'unknown';\n  // /projects/org/project-slug/events/ í˜•ì‹ì—ì„œ ì¶”ì¶œ\n  const match = url.match(/\\/projects\\/[^\\/]+\\/([^\\/]+)\\//);  \n  return match ? match[1] : 'unknown';\n}\n\n// Sentry Event Alert í˜•ì‹ (action: triggered, data.event)\nif (input.action === 'triggered' && input.data?.event) {\n  const event = input.data.event;\n  \n  // URLì—ì„œ í”„ë¡œì íŠ¸ slug ì¶”ì¶œ\n  const projectSlug = extractProjectSlug(event.url);\n  \n  // ê¸°ë³¸ ì •ë³´\n  errorData.project = projectSlug;\n  errorData.project_slug = projectSlug;\n  errorData.title = event.message || event.title || 'Unknown Error';\n  errorData.message = event.message || '';\n  errorData.culprit = event.culprit || '';\n  errorData.environment = event.environment || 'production';\n  errorData.url = event.url || '';\n  errorData.web_url = event.web_url || '';\n  errorData.issue_id = event.issue_id || '';\n  errorData.timestamp = event.datetime || new Date().toISOString();\n  errorData.triggered_rule = input.data.triggered_rule || '';\n  \n  // tagsì—ì„œ level ì¶”ì¶œ (tagsëŠ” [[key, value], ...] í˜•ì‹)\n  if (Array.isArray(event.tags)) {\n    const levelTag = event.tags.find(t => t[0] === 'level');\n    errorData.level = levelTag ? levelTag[1] : 'error';\n    \n    const envTag = event.tags.find(t => t[0] === 'environment');\n    if (envTag) errorData.environment = envTag[1];\n  }\n  \n  // culpritì—ì„œ íŒŒì¼/í•¨ìˆ˜ ì •ë³´ ì¶”ì¶œ (ì˜ˆ: \"io.sentry.example.ApiRequest in perform\")\n  if (event.culprit) {\n    const match = event.culprit.match(/(.+?)\\s+in\\s+(.+)/);\n    if (match) {\n      errorData.filename = match[1];\n      errorData.function = match[2];\n    } else {\n      errorData.filename = event.culprit;\n    }\n  }\n  \n  // ìŠ¤íƒíŠ¸ë ˆì´ìŠ¤ì—ì„œ íŒŒì¼/ë¼ì¸ ì •ë³´ ì¶”ì¶œ\n  if (event.exception?.values?.[0]?.stacktrace?.frames) {\n    const frames = event.exception.values[0].stacktrace.frames;\n    // in_app: trueì¸ í”„ë ˆì„ ë˜ëŠ” ë§ˆì§€ë§‰ í”„ë ˆì„\n    const appFrame = frames.find(f => f.in_app) || frames[frames.length - 1];\n    if (appFrame) {\n      errorData.filename = appFrame.filename || errorData.filename;\n      errorData.lineno = appFrame.lineno || '';\n      errorData.function = appFrame.function || errorData.function;\n    }\n    \n    // ìŠ¤íƒíŠ¸ë ˆì´ìŠ¤ ë¬¸ìì—´ ìƒì„± (in_app í”„ë ˆì„ ìš°ì„ , ë§ˆì§€ë§‰ 5ê°œ)\n    const relevantFrames = frames.filter(f => f.in_app).slice(-5);\n    const framesToShow = relevantFrames.length > 0 ? relevantFrames : frames.slice(-5);\n    errorData.stacktrace = framesToShow.map(f => \n      `  at ${f.function || 'anonymous'} (${f.filename}:${f.lineno})`\n    ).reverse().join('\\\\n');\n  }\n  \n  errorData.source = 'event_alert';\n}\n// Sentry Issue Alert í˜•ì‹ (action + data.issue)\nelse if (input.action && input.data?.issue) {\n  const issue = input.data.issue;\n  \n  errorData.project = issue.project?.slug || issue.project?.name || 'unknown';\n  errorData.project_slug = issue.project?.slug || 'unknown';\n  errorData.title = issue.title || 'Unknown Error';\n  errorData.message = issue.metadata?.value || issue.culprit || '';\n  errorData.level = issue.level || 'error';\n  errorData.url = issue.permalink || '';\n  errorData.culprit = issue.culprit || '';\n  errorData.issue_id = issue.id || '';\n  errorData.event_count = issue.count || 1;\n  errorData.timestamp = issue.lastSeen || issue.firstSeen || new Date().toISOString();\n  \n  if (issue.culprit) {\n    const match = issue.culprit.match(/(.+?)\\s+in\\s+(.+)/);\n    if (match) {\n      errorData.filename = match[1];\n      errorData.function = match[2];\n    } else {\n      errorData.filename = issue.culprit;\n    }\n  }\n  \n  errorData.source = 'issue_alert';\n}\nelse {\n  errorData.title = 'Sentry Alert (íŒŒì‹± í•„ìš”)';\n  errorData.message = JSON.stringify(input).substring(0, 500);\n  errorData.source = 'unknown_format';\n  errorData.raw_keys = Object.keys(input);\n}\n\n// í”„ë¡œì íŠ¸ ì„¤ì • ì¡°íšŒ\nconst projectConfig = PROJECT_CONFIG[errorData.project_slug] || DEFAULT_CONFIG;\n\n// ë””ë²„ê¹… ì •ë³´ í¬í•¨í•´ì„œ ë°˜í™˜\nerrorData.debug = debugInfo;\nerrorData.projectConfig = projectConfig;\nreturn errorData;"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [420, 300],
      "id": "parse-sentry",
      "name": "Parse Sentry Data"
    },
    {
      "parameters": {
        "jsCode": "const errorData = $input.first().json;\n\n// Parse Sentry Dataì—ì„œ ì „ë‹¬ë°›ì€ í”„ë¡œì íŠ¸ ì„¤ì • ì‚¬ìš©\nconst jiraProject = errorData.projectConfig?.jira || 'DEV';\n\n// Jira ìš°ì„ ìˆœìœ„ (error, fatal â†’ Highest + hotfix)\nconst isUrgent = ['error', 'fatal', 'critical'].includes(errorData.level);\nconst priority = isUrgent ? 'Highest' : 'High';\n\n// ë¼ë²¨ (Jiraì— ë¼ë²¨ì´ ì—†ìœ¼ë©´ ë¹ˆ ë°°ì—´ë¡œ)\n// TODO: Jira í”„ë¡œì íŠ¸ì— ì¡´ì¬í•˜ëŠ” ë¼ë²¨ë¡œ ë³€ê²½í•˜ì„¸ìš”\nconst labels = [];\n\n// ìœ„ì¹˜ ì •ë³´ ë¬¸ìì—´\nlet locationInfo = '';\nif (errorData.filename) {\n  locationInfo = errorData.filename;\n  if (errorData.lineno) locationInfo += `:${errorData.lineno}`;\n  if (errorData.function) locationInfo += ` in ${errorData.function}`;\n}\n\n// Jira Description (ë‹¨ìˆœ í…ìŠ¤íŠ¸ - ADFì—ì„œ í‘œì‹œë¨)\nconst description = `ğŸš¨ Sentry ì—ëŸ¬ ì•Œë¦¼\n\n[í”„ë¡œì íŠ¸] ${errorData.project}\n[í™˜ê²½] ${errorData.environment}\n[ì‹¬ê°ë„] ${errorData.level.toUpperCase()}\n[ë°œìƒ íšŸìˆ˜] ${errorData.event_count}íšŒ\n[ìµœê·¼ ë°œìƒ] ${errorData.timestamp}\n\n--- ì—ëŸ¬ ë©”ì‹œì§€ ---\n${errorData.title}\n\n${errorData.message ? `--- ìƒì„¸ ë‚´ìš© ---\\n${errorData.message}\\n\\n` : ''}\n--- ğŸ“ Sentryê°€ ì§€ëª©í•œ ìœ„ì¹˜ ---\n${locationInfo ? `${locationInfo}\\nğŸ‘† ì´ íŒŒì¼/ë¼ì¸ì„ í™•ì¸í•´ë³´ì„¸ìš”!` : 'ìœ„ì¹˜ ì •ë³´ ì—†ìŒ'}\n\n${errorData.stacktrace ? `--- ìŠ¤íƒíŠ¸ë ˆì´ìŠ¤ ---\\n${errorData.stacktrace}\\n\\n` : ''}\n${errorData.web_url ? `ğŸ”— Sentry: ${errorData.web_url}\\n\\n` : ''}\nâš¡ ì´ í‹°ì¼“ì€ Sentry â†’ n8n ìë™í™”ë¡œ ìƒì„±ë˜ì—ˆìŠµë‹ˆë‹¤.\\nğŸ”¥ ê¸´ê¸‰ í•«í”½ìŠ¤ê°€ í•„ìš”í•©ë‹ˆë‹¤!`;\n\nreturn {\n  errorData: errorData,\n  locationInfo: locationInfo,\n  jira: {\n    project: jiraProject,\n    issueType: 'ë²„ê·¸',\n    bugTypeId: errorData.projectConfig?.bugTypeId || '10260',\n    summary: `[Sentry][${errorData.project}] ${errorData.title.substring(0, 80)}`,\n    priority: priority,\n    labels: labels,\n    description: description\n  }\n};"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [640, 300],
      "id": "prepare-jira",
      "name": "Prepare Jira Data"
    },
    {
      "parameters": {
        "method": "POST",
        "url": "https://ryuqqq.atlassian.net/rest/api/3/issue",
        "authentication": "genericCredentialType",
        "genericAuthType": "httpBasicAuth",
        "sendBody": true,
        "specifyBody": "json",
        "jsonBody": "={{ JSON.stringify({ fields: { project: { key: $json.jira.project }, issuetype: { id: $json.jira.bugTypeId }, summary: $json.jira.summary, description: { type: 'doc', version: 1, content: [{ type: 'paragraph', content: [{ type: 'text', text: $json.jira.description }] }] } } }) }}",
        "options": {
          "response": {
            "response": {
              "fullResponse": false
            }
          }
        }
      },
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.2,
      "position": [860, 300],
      "id": "create-jira",
      "name": "Create Jira Ticket",
      "credentials": {
        "httpBasicAuth": {
          "id": "JIRA_BASIC_AUTH_ID",
          "name": "Jira Basic Auth"
        }
      }
    },
    {
      "parameters": {
        "jsCode": "const jiraResult = $input.first().json;\nconst preparedData = $('Prepare Jira Data').first().json;\n\n// Jira ë„ë©”ì¸ ì„¤ì • (TODO: ë³¸ì¸ ë„ë©”ì¸ìœ¼ë¡œ ë³€ê²½)\nconst jiraDomain = 'ryuqqq.atlassian.net';\n\nreturn {\n  errorData: preparedData.errorData,\n  locationInfo: preparedData.locationInfo,\n  jira: {\n    key: jiraResult.key,\n    id: jiraResult.id,\n    url: `https://${jiraDomain}/browse/${jiraResult.key}`,\n    summary: preparedData.jira.summary,\n    priority: preparedData.jira.priority,\n    labels: preparedData.jira.labels\n  }\n};"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [1080, 300],
      "id": "format-jira-result",
      "name": "Format Jira Result"
    },
    {
      "parameters": {
        "jsCode": "const data = $input.first().json;\nconst errorData = data.errorData;\n\n// Parse Sentry Dataì—ì„œ ì „ë‹¬ë°›ì€ í”„ë¡œì íŠ¸ ì„¤ì • ì‚¬ìš©\nconst repo = errorData.projectConfig?.github || 'ryu-qqq/ProductHub';\nconst [owner, repository] = repo.split('/');\n\n// GitHub Issue ë¼ë²¨ (ë ˆí¬ì— ì—†ëŠ” ë¼ë²¨ì€ 422 ì—ëŸ¬ ë°œìƒí•˜ë¯€ë¡œ ë¹ˆ ë°°ì—´ë¡œ)\nconst labels = [];\n\n// GitHub Issue ë³¸ë¬¸\nconst body = `## ğŸš¨ Sentry ì—ëŸ¬ ì•Œë¦¼\n\n### ì—ëŸ¬ ì •ë³´\n| í•­ëª© | ê°’ |\n|------|----|\n| **í”„ë¡œì íŠ¸** | ${errorData.project} |\n| **í™˜ê²½** | ${errorData.environment} |\n| **ì‹¬ê°ë„** | \\`${errorData.level.toUpperCase()}\\` |\n| **ë°œìƒ íšŸìˆ˜** | ${errorData.event_count}íšŒ |\n| **Jira í‹°ì¼“** | [${data.jira.key}](${data.jira.url}) |\n\n### ì—ëŸ¬ ë©”ì‹œì§€\n\\`\\`\\`\n${errorData.title}\n\\`\\`\\`\n\n### ğŸ“ Sentryê°€ ì§€ëª©í•œ ìœ„ì¹˜\n${data.locationInfo ? `\\`\\`\\`\\n${data.locationInfo}\\n\\`\\`\\`\\n\\nğŸ‘† **ì´ íŒŒì¼/ë¼ì¸ì„ í™•ì¸í•´ë³´ì„¸ìš”!**` : '_ìœ„ì¹˜ ì •ë³´ ì—†ìŒ_'}\n\n${errorData.stacktrace ? `### ìŠ¤íƒíŠ¸ë ˆì´ìŠ¤\\n\\`\\`\\`\\n${errorData.stacktrace}\\n\\`\\`\\`\\n\\n` : ''}\n\n---\n- ğŸ”— [Jira í‹°ì¼“](${data.jira.url})\n${errorData.web_url ? `- ğŸ”— [Sentryì—ì„œ ë³´ê¸°](${errorData.web_url})` : ''}\n\n---\n_ì´ ì´ìŠˆëŠ” Sentry â†’ n8n ìë™í™”ë¡œ ìƒì„±ë˜ì—ˆìŠµë‹ˆë‹¤._\n_ğŸ”¥ ê¸´ê¸‰ í•«í”½ìŠ¤ê°€ í•„ìš”í•©ë‹ˆë‹¤!_`;\n\nreturn {\n  ...data,\n  github: {\n    owner: owner,\n    repository: repository,\n    title: `[Sentry][Hotfix] ${errorData.title.substring(0, 80)}`,\n    body: body,\n    labels: labels\n  }\n};"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [1300, 300],
      "id": "prepare-github",
      "name": "Prepare GitHub Issue"
    },
    {
      "parameters": {
        "resource": "issue",
        "operation": "create",
        "owner": "={{ $json.github.owner }}",
        "repository": "={{ $json.github.repository }}",
        "title": "={{ $json.github.title }}",
        "body": "={{ $json.github.body }}"
      },
      "type": "n8n-nodes-base.github",
      "typeVersion": 1,
      "position": [1520, 300],
      "id": "create-github-issue",
      "name": "Create GitHub Issue",
      "credentials": {
        "githubApi": {
          "id": "GITHUB_CREDENTIAL_ID",
          "name": "GitHub API"
        }
      }
    },
    {
      "parameters": {
        "jsCode": "const data = $('Prepare GitHub Issue').first().json;\nconst githubResult = $input.first().json;\n\nreturn {\n  errorData: data.errorData,\n  locationInfo: data.locationInfo,\n  jira: data.jira,\n  github: {\n    number: githubResult.number,\n    url: githubResult.html_url,\n    title: data.github.title\n  }\n};"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [1740, 300],
      "id": "format-github-result",
      "name": "Format GitHub Result"
    },
    {
      "parameters": {
        "authentication": "oAuth2",
        "select": "channel",
        "channelId": {
          "__rl": true,
          "mode": "id",
          "value": "C0A8RU0UR4M"
        },
        "text": "=:rotating_light: *Sentry ì—ëŸ¬ â†’ ìë™ í•«í”½ìŠ¤ ìš”ì²­*\n\n<@U0A8KTYFCKU> ì•„ë˜ ë²„ê·¸ë¥¼ ë¶„ì„í•˜ê³  hotfix PRì„ ìƒì„±í•´ì£¼ì„¸ìš”.\n\n*ë ˆí¬ì§€í† ë¦¬*: `{{ $json.errorData.projectConfig.github }}`\n*í”„ë¡œì íŠ¸*: `{{ $json.errorData.project }}`\n*ì‹¬ê°ë„*: `{{ $json.errorData.level.toUpperCase() }}` {{ ['error', 'fatal', 'critical'].includes($json.errorData.level) ? ':fire: *ê¸´ê¸‰*' : '' }}\n*í™˜ê²½*: {{ $json.errorData.environment }}\n\n*ì—ëŸ¬ ë©”ì‹œì§€*:\n```{{ $json.errorData.title }}```\n\n{{ $json.locationInfo ? ':mag: *ì—ëŸ¬ ìœ„ì¹˜*: `' + $json.locationInfo + '`' : '' }}\n{{ $json.errorData.stacktrace ? '\\n*ìŠ¤íƒíŠ¸ë ˆì´ìŠ¤*:\\n```' + $json.errorData.stacktrace + '```' : '' }}\n\n---\n:jira: *Jira*: <{{ $json.jira.url }}|{{ $json.jira.key }}>\n:github: *Issue*: <{{ $json.github.url }}|#{{ $json.github.number }}>\n{{ $json.errorData.web_url ? ':sentry: <' + $json.errorData.web_url + '|Sentryì—ì„œ ë³´ê¸°>' : '' }}\n\n:robot_face: *ìš”ì²­*: ìœ„ ì—ëŸ¬ë¥¼ ë¶„ì„í•˜ê³  `hotfix/sentry-{{ $json.github.number }}` ë¸Œëœì¹˜ì— ìˆ˜ì • PRì„ ìƒì„±í•´ì£¼ì„¸ìš”.\\n\\n:warning: *PR ìƒì„± ì‹œ í•„ìˆ˜ í¬í•¨*:\\nâ€¢ PR ë³¸ë¬¸ì— `Closes #{{ $json.github.number }}` (Issue ìë™ ë‹«ê¸°)\\nâ€¢ PR ë³¸ë¬¸ì— `Jira: {{ $json.jira.key }}` (Jira ì—°ë™)\\n{{ $json.errorData.web_url ? 'â€¢ PR ë³¸ë¬¸ì— Sentry ë§í¬: ' + $json.errorData.web_url + ' (Sentry ìë™ í•´ê²°)' : '' }}",
        "otherOptions": {
          "includeLinkToWorkflow": false
        }
      },
      "type": "n8n-nodes-base.slack",
      "typeVersion": 2.2,
      "position": [1960, 300],
      "id": "notify-slack",
      "name": "Send Slack Notification",
      "credentials": {
        "slackOAuth2Api": {
          "id": "SLACK_CREDENTIAL_ID",
          "name": "Slack OAuth"
        }
      }
    },
    {
      "parameters": {
        "httpMethod": "POST",
        "path": "github-pr-merged",
        "options": {}
      },
      "type": "n8n-nodes-base.webhook",
      "typeVersion": 2,
      "position": [200, 600],
      "id": "webhook-pr-merge",
      "name": "GitHub PR Webhook",
      "webhookId": "github-pr-merged-webhook"
    },
    {
      "parameters": {
        "jsCode": "const rawInput = $input.first().json;\nconst input = rawInput.body || rawInput;\n\n// PR ì´ë²¤íŠ¸ê°€ ì•„ë‹ˆê±°ë‚˜ ë¨¸ì§€ê°€ ì•„ë‹ˆë©´ ìŠ¤í‚µ\nif (input.action !== 'closed' || !input.pull_request?.merged) {\n  return { skip: true, reason: 'Not a merged PR' };\n}\n\nconst pr = input.pull_request;\nconst branch = pr.head?.ref || '';\n\n// hotfix ë¸Œëœì¹˜ê°€ ì•„ë‹ˆë©´ ìŠ¤í‚µ (ì´ ì›Œí¬í”Œë¡œìš°ëŠ” Sentry í•«í”½ìŠ¤ ì „ìš©)\nif (!branch.startsWith('hotfix/')) {\n  return { skip: true, reason: 'Not a hotfix branch: ' + branch };\n}\n\nconst body = pr.body || '';\n\n// PR ë³¸ë¬¸ì—ì„œ Jira í‚¤ ì¶”ì¶œ (ì˜ˆ: GAT-123, KAN-456)\nconst jiraMatch = body.match(/Jira:\\s*([A-Z]+-\\d+)/i) || body.match(/([A-Z]+-\\d+)/);\nconst jiraKey = jiraMatch ? jiraMatch[1] : null;\n\n// PR ë³¸ë¬¸ì—ì„œ GitHub Issue ë²ˆí˜¸ ì¶”ì¶œ (Closes #123)\nconst issueMatch = body.match(/Closes\\s*#(\\d+)/i) || body.match(/Fixes\\s*#(\\d+)/i);\nconst issueNumber = issueMatch ? issueMatch[1] : null;\n\nreturn {\n  skip: false,\n  pr: {\n    number: pr.number,\n    title: pr.title,\n    url: pr.html_url,\n    branch: branch,\n    mergedBy: pr.merged_by?.login || 'unknown',\n    mergedAt: pr.merged_at\n  },\n  jiraKey: jiraKey,\n  issueNumber: issueNumber,\n  repo: input.repository?.full_name || 'unknown'\n};"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [420, 600],
      "id": "parse-pr-merge",
      "name": "Parse PR Merge"
    },
    {
      "parameters": {
        "conditions": {
          "options": {
            "caseSensitive": true,
            "leftValue": "",
            "typeValidation": "strict"
          },
          "conditions": [
            {
              "id": "condition-jira",
              "leftValue": "={{ $json.skip }}",
              "rightValue": false,
              "operator": {
                "type": "boolean",
                "operation": "equals"
              }
            },
            {
              "id": "condition-jira-key",
              "leftValue": "={{ $json.jiraKey }}",
              "rightValue": "",
              "operator": {
                "type": "string",
                "operation": "isNotEmpty"
              }
            }
          ],
          "combinator": "and"
        }
      },
      "type": "n8n-nodes-base.if",
      "typeVersion": 2,
      "position": [640, 600],
      "id": "check-jira-key",
      "name": "Has Jira Key?"
    },
    {
      "parameters": {
        "method": "POST",
        "url": "=https://ryuqqq.atlassian.net/rest/api/3/issue/{{ $json.jiraKey }}/transitions",
        "authentication": "genericCredentialType",
        "genericAuthType": "httpBasicAuth",
        "sendBody": true,
        "specifyBody": "json",
        "jsonBody": "={ \"transition\": { \"id\": \"31\" } }",
        "options": {
          "response": {
            "response": {
              "fullResponse": false
            }
          }
        }
      },
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.2,
      "position": [860, 550],
      "id": "update-jira-done",
      "name": "Update Jira to Done",
      "credentials": {
        "httpBasicAuth": {
          "id": "JIRA_BASIC_AUTH_ID",
          "name": "Jira Basic Auth"
        }
      }
    },
    {
      "parameters": {
        "authentication": "oAuth2",
        "select": "channel",
        "channelId": {
          "__rl": true,
          "mode": "id",
          "value": "C0A8RU0UR4M"
        },
        "text": "=:white_check_mark: *í•«í”½ìŠ¤ ì™„ë£Œ!*\n\n*PR*: <{{ $('Parse PR Merge').first().json.pr.url }}|#{{ $('Parse PR Merge').first().json.pr.number }}> {{ $('Parse PR Merge').first().json.pr.title }}\n*ë¨¸ì§€í•œ ì‚¬ëŒ*: {{ $('Parse PR Merge').first().json.pr.mergedBy }}\n*ë ˆí¬*: `{{ $('Parse PR Merge').first().json.repo }}`\n{{ $('Parse PR Merge').first().json.jiraKey ? ':jira: *Jira*: ' + $('Parse PR Merge').first().json.jiraKey + ' â†’ *ì™„ë£Œ* ì²˜ë¦¬ë¨' : '' }}\n{{ $('Parse PR Merge').first().json.issueNumber ? ':github: *Issue*: #' + $('Parse PR Merge').first().json.issueNumber + ' â†’ ìë™ ë‹«í˜' : '' }}\n\n:tada: ì—ëŸ¬ê°€ í•´ê²°ë˜ì—ˆìŠµë‹ˆë‹¤!",
        "otherOptions": {
          "includeLinkToWorkflow": false
        }
      },
      "type": "n8n-nodes-base.slack",
      "typeVersion": 2.2,
      "position": [1080, 550],
      "id": "notify-completion",
      "name": "Send Completion Slack",
      "credentials": {
        "slackOAuth2Api": {
          "id": "SLACK_CREDENTIAL_ID",
          "name": "Slack OAuth"
        }
      }
    }
  ],
  "connections": {
    "Sentry Webhook": {
      "main": [
        [{"node": "Parse Sentry Data", "type": "main", "index": 0}]
      ]
    },
    "Parse Sentry Data": {
      "main": [
        [{"node": "Prepare Jira Data", "type": "main", "index": 0}]
      ]
    },
    "Prepare Jira Data": {
      "main": [
        [{"node": "Create Jira Ticket", "type": "main", "index": 0}]
      ]
    },
    "Create Jira Ticket": {
      "main": [
        [{"node": "Format Jira Result", "type": "main", "index": 0}]
      ]
    },
    "Format Jira Result": {
      "main": [
        [{"node": "Prepare GitHub Issue", "type": "main", "index": 0}]
      ]
    },
    "Prepare GitHub Issue": {
      "main": [
        [{"node": "Create GitHub Issue", "type": "main", "index": 0}]
      ]
    },
    "Create GitHub Issue": {
      "main": [
        [{"node": "Format GitHub Result", "type": "main", "index": 0}]
      ]
    },
    "Format GitHub Result": {
      "main": [
        [{"node": "Send Slack Notification", "type": "main", "index": 0}]
      ]
    },
    "GitHub PR Webhook": {
      "main": [
        [{"node": "Parse PR Merge", "type": "main", "index": 0}]
      ]
    },
    "Parse PR Merge": {
      "main": [
        [{"node": "Has Jira Key?", "type": "main", "index": 0}]
      ]
    },
    "Has Jira Key?": {
      "main": [
        [{"node": "Update Jira to Done", "type": "main", "index": 0}],
        []
      ]
    },
    "Update Jira to Done": {
      "main": [
        [{"node": "Send Completion Slack", "type": "main", "index": 0}]
      ]
    }
  },
  "settings": {
    "executionOrder": "v1"
  },
  "staticData": null,
  "meta": {
    "templateId": "sentry-jira-orchestrator",
    "description": "Sentry ì—ëŸ¬ â†’ Jira í‹°ì¼“ â†’ GitHub Issue â†’ Slack (@Claude í•«í”½ìŠ¤ ìš”ì²­) + PR ë¨¸ì§€ ì‹œ Jira ì™„ë£Œ ì²˜ë¦¬",
    "version": "2.1.0",
    "created": "2025-01-15",
    "updated": "2025-01-16",
    "flows": {
      "sentry_to_hotfix": "Sentry Webhook â†’ Parse â†’ Jira â†’ GitHub Issue â†’ Slack @Claude",
      "pr_merge_completion": "GitHub PR Webhook â†’ Parse PR â†’ Jira Done â†’ Slack ì™„ë£Œ"
    },
    "credentials_required": [
      "JIRA_CREDENTIAL_ID - Jira Cloud API",
      "GITHUB_CREDENTIAL_ID - GitHub Personal Access Token",
      "SLACK_CREDENTIAL_ID - Slack OAuth2"
    ],
    "setup_notes": [
      "1. Format Jira Result ë…¸ë“œì—ì„œ jiraDomainì„ ë³¸ì¸ Jira ë„ë©”ì¸ìœ¼ë¡œ ë³€ê²½",
      "2. Send Slack Notification ë…¸ë“œì—ì„œ ì±„ë„ IDë¥¼ ì‹¤ì œ ì±„ë„ IDë¡œ ë³€ê²½",
      "3. Prepare GitHub Issue ë…¸ë“œì—ì„œ repoMappingì„ ë³¸ì¸ ë ˆí¬ì§€í† ë¦¬ë¡œ í™•ì¸/ìˆ˜ì •",
      "4. ê° í¬ë¦¬ë´ì…œ IDë¥¼ ì‹¤ì œ n8n í¬ë¦¬ë´ì…œ IDë¡œ ë³€ê²½",
      "5. GitHub â†’ Settings â†’ Webhooksì—ì„œ PR ì´ë²¤íŠ¸(Pull requests) webhook ì¶”ê°€:",
      "   - URL: {n8n-webhook-url}/github-pr-merged",
      "   - Content type: application/json",
      "   - Events: Pull requests (Let me select individual events)",
      "6. Update Jira to Done ë…¸ë“œì˜ transition ID '31'ì´ ë³¸ì¸ Jiraì˜ 'Done' ìƒíƒœ IDì¸ì§€ í™•ì¸",
      "   - GET /rest/api/3/issue/{issueKey}/transitions ë¡œ í™•ì¸ ê°€ëŠ¥"
    ],
    "project_mapping": {
      "product-hub": {"jira": "PROD", "github": "ryu-qqq/ProductHub"},
      "auth-hub": {"jira": "AUTH", "github": "ryu-qqq/AuthHub"},
      "crawler": {"jira": "CRAWL", "github": "ryu-qqq/Crawler"},
      "mcp-server": {"jira": "MCP", "github": "ryu-qqq/mcp-server"},
      "infrastructure": {"jira": "INFRA", "github": "ryu-qqq/infrastructure"}
    }
  }
}
