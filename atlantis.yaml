# Atlantis Configuration for Infrastructure Repository
# https://www.runatlantis.io/docs/repo-level-atlantis-yaml.html

version: 3

# Global settings
automerge: false
delete_source_branch_on_merge: false
parallel_plan: true
parallel_apply: false

# Projects configuration
projects:
  # Atlantis Server Infrastructure
  - name: atlantis-prod
    dir: terraform/atlantis
    workspace: default
    terraform_version: v1.5.0
    autoplan:
      when_modified: ["*.tf", "*.tfvars"]
      enabled: true
    apply_requirements: ["approved", "mergeable"]
    workflow: default

  # Test Infrastructure for Atlantis Integration Testing
  - name: atlantis-test
    dir: terraform/test
    workspace: default
    terraform_version: v1.5.0
    autoplan:
      when_modified: ["*.tf", "*.tfvars"]
      enabled: true
    apply_requirements: ["approved", "mergeable"]
    workflow: default

# Workflows
workflows:
  default:
    plan:
      steps:
        - init
        - plan
    apply:
      steps:
        - apply
